<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.culturecloud.dao.activity.CmsActivityMapper" >
  <resultMap id="BaseResultMap" type="com.culturecloud.model.bean.activity.CmsActivity" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 17:38:21 CST 2016.
    -->
    <id column="ACTIVITY_ID" property="activityId" jdbcType="VARCHAR" />
    <result column="ACTIVITY_NAME" property="activityName" jdbcType="VARCHAR" />
    <result column="ACTIVITY_LINKMAN" property="activityLinkman" jdbcType="VARCHAR" />
    <result column="ACTIVITY_TEL" property="activityTel" jdbcType="VARCHAR" />
    <result column="ACTIVITY_SORT" property="activitySort" jdbcType="INTEGER" />
    <result column="ACTIVITY_IS_TOP" property="activityIsTop" jdbcType="INTEGER" />
    <result column="ACTIVITY_ICON_URL" property="activityIconUrl" jdbcType="VARCHAR" />
    <result column="ACTIVITY_PROVINCE" property="activityProvince" jdbcType="VARCHAR" />
    <result column="ACTIVITY_CITY" property="activityCity" jdbcType="VARCHAR" />
    <result column="ACTIVITY_AREA" property="activityArea" jdbcType="VARCHAR" />
    <result column="ACTIVITY_ADDRESS" property="activityAddress" jdbcType="VARCHAR" />
    <result column="ACTIVITY_LON" property="activityLon" jdbcType="DOUBLE" />
    <result column="ACTIVITY_LAT" property="activityLat" jdbcType="DOUBLE" />
    <result column="ACTIVITY_TIME" property="activityTime" jdbcType="VARCHAR" />
    <result column="ACTIVITY_IS_FREE" property="activityIsFree" jdbcType="INTEGER" />
    <result column="ACTIVITY_PRICE" property="activityPrice" jdbcType="VARCHAR" />
    <result column="ACTIVITY_IS_DETAILS" property="activityIsDetails" jdbcType="INTEGER" />
    <result column="ACTIVITY_IS_RESERVATION" property="activityIsReservation" jdbcType="INTEGER" />
    <result column="ACTIVITY_RESERVATION_COUNT" property="activityReservationCount" jdbcType="INTEGER" />
    <result column="ACTIVITY_START_TIME" property="activityStartTime" jdbcType="VARCHAR" />
    <result column="ACTIVITY_END_TIME" property="activityEndTime" jdbcType="VARCHAR" />
    <result column="ACTIVITY_IS_DEL" property="activityIsDel" jdbcType="INTEGER" />
    <result column="ACTIVITY_STATE" property="activityState" jdbcType="INTEGER" />
    <result column="ACTIVITY_CREATE_TIME" property="activityCreateTime" jdbcType="TIMESTAMP" />
    <result column="ACTIVITY_UPDATE_TIME" property="activityUpdateTime" jdbcType="TIMESTAMP" />
    <result column="ACTIVITY_CREATE_USER" property="activityCreateUser" jdbcType="VARCHAR" />
    <result column="ACTIVITY_UPDATE_USER" property="activityUpdateUser" jdbcType="VARCHAR" />
    <result column="ACTIVITY_RECOMMEND" property="activityRecommend" jdbcType="VARCHAR" />
    <result column="ACTIVITY_SALES_ONLINE" property="activitySalesOnline" jdbcType="VARCHAR" />
    <result column="ACTIVITY_TIME_DES" property="activityTimeDes" jdbcType="VARCHAR" />
    <result column="ACTIVITY_LOCATION" property="activityLocation" jdbcType="VARCHAR" />
    <result column="SYS_ID" property="sysId" jdbcType="VARCHAR" />
    <result column="SYS_NO" property="sysNo" jdbcType="VARCHAR" />
    <result column="CREATE_ACTIVITY_CODE" property="createActivityCode" jdbcType="INTEGER" />
    <result column="EVENT_COUNT" property="eventCount" jdbcType="INTEGER" />
    <result column="ACTIVITY_RECOMMEND_TIME" property="activityRecommendTime" jdbcType="TIMESTAMP" />
    <result column="ACTIVITY_HOST" property="activityHost" jdbcType="VARCHAR" />
    <result column="ACTIVITY_ORGANIZER" property="activityOrganizer" jdbcType="VARCHAR" />
    <result column="ACTIVITY_COORGANIZER" property="activityCoorganizer" jdbcType="VARCHAR" />
    <result column="ACTIVITY_PERFORMED" property="activityPerformed" jdbcType="VARCHAR" />
    <result column="ACTIVITY_PROMPT" property="activityPrompt" jdbcType="VARCHAR" />
    <result column="ACTIVITY_SPEAKER" property="activitySpeaker" jdbcType="VARCHAR" />
    <result column="ACTIVITY_PERSONAL" property="activityPersonal" jdbcType="INTEGER" />
    <result column="ACTIVITY_RECOMMEND_USERID" property="activityRecommendUserid" jdbcType="VARCHAR" />
    <result column="ACTIVITY_TERMINAL_USER_ID" property="activityTerminalUserId" jdbcType="VARCHAR" />
    <result column="TEMPL_ID" property="templId" jdbcType="VARCHAR" />
    <result column="ACTIVITY_SITE" property="activitySite" jdbcType="VARCHAR" />
    <result column="ACTIVITY_SUBJECT" property="activitySubject" jdbcType="VARCHAR" />
    <result column="PRICE_DESCRIBE" property="priceDescribe" jdbcType="VARCHAR" />
    <result column="RATINGS_INFO" property="ratingsInfo" jdbcType="VARCHAR" />
    <result column="TICKET_SETTINGS" property="ticketSettings" jdbcType="CHAR" />
    <result column="TICKET_NUMBER" property="ticketNumber" jdbcType="INTEGER" />
    <result column="TICKET_COUNT" property="ticketCount" jdbcType="INTEGER" />
    <result column="PUBLIC_TIME" property="publicTime" jdbcType="TIMESTAMP" />
    <result column="IDENTITY_CARD" property="identityCard" jdbcType="INTEGER" />
    <result column="PRICE_TYPE" property="priceType" jdbcType="INTEGER" />
    <result column="LOWEST_CREDIT" property="lowestCredit" jdbcType="INTEGER" />
    <result column="COST_CREDIT" property="costCredit" jdbcType="INTEGER" />
    <result column="DEDUCTION_CREDIT" property="deductionCredit" jdbcType="INTEGER" />
    <result column="SPIKE_TYPE" property="spikeType" jdbcType="INTEGER" />
    <result column="SINGLE_EVENT" property="singleEvent" jdbcType="INTEGER" />
    <result column="ASSN_ID" property="assnId" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="ResultMapWithBLOBs" type="com.culturecloud.model.bean.activity.CmsActivity" extends="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 17:38:21 CST 2016.
    -->
    <result column="ACTIVITY_TYPE" property="activityType" jdbcType="LONGVARCHAR" />
    <result column="ACTIVITY_MEMO" property="activityMemo" jdbcType="LONGVARCHAR" />
    <result column="ACTIVITY_CONTENT" property="activityContent" jdbcType="LONGVARCHAR" />
    <result column="ACTIVITY_DEPT" property="activityDept" jdbcType="LONGVARCHAR" />
    <result column="ACTIVITY_MOOD" property="activityMood" jdbcType="LONGVARCHAR" />
    <result column="ACTIVITY_CROWD" property="activityCrowd" jdbcType="LONGVARCHAR" />
    <result column="ACTIVITY_ATTACHMENT" property="activityAttachment" jdbcType="LONGVARCHAR" />
    <result column="ACTIVITY_THEME" property="activityTheme" jdbcType="LONGVARCHAR" />
    <result column="ACTIVITY_NOTICE" property="activityNotice" jdbcType="LONGVARCHAR" />
  </resultMap>
  
  <resultMap id="BaseResultDtoMap" type="com.culturecloud.dao.dto.activity.CmsActivityDto" extends="ResultMapWithBLOBs">
       <result column="VENUE_NAME" property="venueName" jdbcType="VARCHAR"/>
       
       <result column="AVAILABLE_COUNT" property="availableCount" jdbcType="INTEGER"/>
       <result column="year_browse_count" property="yearBrowseCount" jdbcType="INTEGER"/>
       <result column="eventimes" property="eventimes" jdbcType="VARCHAR"/>
       <result column="dict_name" property="dictName" jdbcType="VARCHAR"/>
       
       <result column="dateNums" property="dateNums" jdbcType="INTEGER"/>
       <result column="collectNum" property="collectNum" jdbcType="INTEGER"/>
        <result column="TAG_NAME" property="tagName" jdbcType="VARCHAR" />
  </resultMap>
  
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 17:38:21 CST 2016.
    -->
    ACTIVITY_ID, ACTIVITY_NAME, ACTIVITY_LINKMAN, ACTIVITY_TEL,
     ACTIVITY_ICON_URL, ACTIVITY_PROVINCE, ACTIVITY_CITY, ACTIVITY_AREA,
    ACTIVITY_ADDRESS, ACTIVITY_LON, ACTIVITY_LAT, ACTIVITY_TIME, ACTIVITY_IS_FREE, ACTIVITY_PRICE, 
    ACTIVITY_IS_DETAILS, ACTIVITY_IS_RESERVATION, ACTIVITY_RESERVATION_COUNT, ACTIVITY_START_TIME, 
    ACTIVITY_END_TIME, ACTIVITY_IS_DEL, ACTIVITY_STATE, ACTIVITY_CREATE_TIME, ACTIVITY_UPDATE_TIME, 
    ACTIVITY_CREATE_USER, ACTIVITY_UPDATE_USER, ACTIVITY_RECOMMEND, ACTIVITY_SALES_ONLINE,
    ACTIVITY_TIME_DES, ACTIVITY_LOCATION, SYS_ID, SYS_NO, CREATE_ACTIVITY_CODE,
    EVENT_COUNT, ACTIVITY_RECOMMEND_TIME, ACTIVITY_HOST, ACTIVITY_ORGANIZER, ACTIVITY_COORGANIZER, 
    ACTIVITY_PERFORMED, ACTIVITY_PROMPT, ACTIVITY_SPEAKER, ACTIVITY_PERSONAL, ACTIVITY_RECOMMEND_USERID, 
    ACTIVITY_TERMINAL_USER_ID, TEMPL_ID, ACTIVITY_SITE, ACTIVITY_SUBJECT, PRICE_DESCRIBE, 
    RATINGS_INFO, TICKET_SETTINGS, TICKET_NUMBER, TICKET_COUNT, PUBLIC_TIME, IDENTITY_CARD, 
    PRICE_TYPE, LOWEST_CREDIT, COST_CREDIT, DEDUCTION_CREDIT, SPIKE_TYPE, SINGLE_EVENT, 
    ASSN_ID
  </sql>
  <sql id="Blob_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jul 26 17:38:21 CST 2016.
    -->
    ACTIVITY_TYPE, ACTIVITY_MEMO, ACTIVITY_CONTENT, ACTIVITY_DEPT,
    ACTIVITY_ATTACHMENT, ACTIVITY_THEME, ACTIVITY_NOTICE
  </sql>
  
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Jul 26 17:38:21 CST 2016.
        -->
        select
        <include refid="Base_Column_List"/>
        ,
        <include refid="Blob_Column_List"/>
        from cms_activity
        where ACTIVITY_ID = #{activityId,jdbcType=VARCHAR}
    </select>
  
   <!-- 查询后台活动列表信息 -->
    <select id="queryCmsActivityByActivityId" resultMap="BaseResultMap">
		SELECT
		a.ACTIVITY_ID,
		a.ACTIVITY_NAME,
		a.ACTIVITY_TYPE,
		a.ACTIVITY_LINKMAN,
		a.ACTIVITY_TEL,
		a.ACTIVITY_START_TIME,
		a.ACTIVITY_END_TIME,
		a.ACTIVITY_LON,
		a.ACTIVITY_LAT,
		a.ACTIVITY_THEME,
		a.ACTIVITY_PROVINCE,
		a.ACTIVITY_CITY,
		a.ACTIVITY_CREATE_TIME,
		a.ACTIVITY_AREA,
		a.ACTIVITY_ADDRESS,
		a.ACTIVITY_IS_FREE,
		a.ACTIVITY_PRICE,
		a.ACTIVITY_ICON_URL,
		a.ACTIVITY_IS_DEL,
		a.ACTIVITY_STATE,
		a.ACTIVITY_MEMO,
		a.ACTIVITY_TIME_DES,
		a.ACTIVITY_SALES_ONLINE,
		a.ACTIVITY_PERSONAL,
		a.EVENT_COUNT as EVENT_COUNT,
		a.ACTIVITY_DEPT,
		a.ACTIVITY_NOTICE,
		sum(cae.AVAILABLE_COUNT) as activityReservationCount,
		a.ACTIVITY_IS_RESERVATION,
		a.ACTIVITY_RECOMMEND,
		a.ACTIVITY_LOCATION,
		a.SYS_ID,
		a.SYS_NO,
		a.CREATE_ACTIVITY_CODE,
		a.ACTIVITY_HOST,
		a.ACTIVITY_ORGANIZER,
		a.ACTIVITY_COORGANIZER,
		a.ACTIVITY_PERFORMED,
		a.ACTIVITY_PROMPT,
		a.ACTIVITY_SPEAKER,
		a.ACTIVITY_ATTACHMENT,
		v.VENUE_NAME as venueName,
		v.venue_id AS venue_id,
		v.venue_type AS venue_type,
		v.venue_area AS
		venue_area,
		caus.yearBrowseCount as yearBrowseCount,
		a.ACTIVITY_TERMINAL_USER_ID,
		a.ACTIVITY_SITE,
		a.ACTIVITY_SUBJECT,
		a.TEMPL_ID,
		a.PRICE_DESCRIBE,
		a.TICKET_SETTINGS,
		a.TICKET_NUMBER,
        a.TICKET_COUNT,
        a.COST_CREDIT,
        a.DEDUCTION_CREDIT,
		a.LOWEST_CREDIT,
		a.SPIKE_TYPE,
		a.IDENTITY_CARD,
		a.SINGLE_EVENT

		FROM cms_activity a
		LEFT JOIN
		cms_activity_event cae
		on a.activity_id= cae.ACTIVITY_ID and  substring(cae.EVENT_DATE_TIME,1,16) > CURRENT_TIMESTAMP
		LEFT JOIN
		cms_activity_venue_relevance r
		ON a.activity_id=r.activity_id
		LEFT JOIN cms_venue v on
		v.venue_id=r.venue_id LEFT JOIN
		cms_statistics
		s on s.S_ID = a.activity_id
		LEFT JOIN (select activity_id, count(activity_id) as yearBrowseCount from cms_activity_user_statistics where OPERATE_TYPE=1 group by activity_id) as caus on caus.ACTIVITY_ID = a.activity_id
		where 1=1
		AND a.activity_id= #{0}
		limit 1;
	</select>
  

</mapper>