<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sun3d.why.dao.BpInfoTagMapper">
	<resultMap id="BaseResultMap" type="com.sun3d.why.model.BpInfoTag">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Aug 15 
			11:31:29 CST 2017. -->
		<id column="TAG_ID" property="tagId" jdbcType="VARCHAR" />
		<result column="TAG_NAME" property="tagName" jdbcType="VARCHAR" />
		<result column="TAG_PARENT_ID" property="tagParentId" jdbcType="VARCHAR" />
		<result column="TAG_CODE" property="tagCode" jdbcType="VARCHAR" />
		<result column="TAG_STATE" property="tagState" jdbcType="INTEGER" />
		<result column="TAG_CREATE_USER" property="tagCreateUser"
			jdbcType="VARCHAR" />
		<result column="TAG_UPDATE_USER" property="tagUpdateUser"
			jdbcType="VARCHAR" />
		<result column="TAG_CREATE_TIME" property="tagCreateTime"
			jdbcType="TIMESTAMP" />
		<result column="TAG_UPDATE_TIME" property="tagUpdateTime"
			jdbcType="TIMESTAMP" />
		<result column="TAG_AMOUNT" property="tagAmount"
			jdbcType="INTEGER" />
		<result column="TAG_MODULE" jdbcType="VARCHAR"
				property="module" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Aug 15 
			11:31:29 CST 2017. -->
		TAG_ID, TAG_NAME, TAG_PARENT_ID, TAG_STATE,TAG_AMOUNT,TAG_CODE,
		TAG_CREATE_USER,
		TAG_UPDATE_USER, TAG_CREATE_TIME, TAG_UPDATE_TIME
	</sql>
	
	<!-- 根据父标签编码查找子标签编码集合 -->
	<select id="queryChildTagByCode" resultMap="BaseResultMap"
		parameterType="java.lang.String" >
	SELECT 
		BIT.TAG_CODE,
		BIT.TAG_ID,
		BIT.TAG_NAME
	FROM
		BP_INFO_TAG AS BIT
	LEFT JOIN
		BP_INFO_TAG AS PBIT
	ON 
		BIT.TAG_PARENT_ID = PBIT.TAG_ID
	WHERE
		PBIT.TAG_CODE = #{parentTagCode,jdbcType=VARCHAR}
	AND 
		BIT.TAG_STATE ='1'
	AND
		PBIT.TAG_STATE ='1'
	ORDER BY
		BIT.TAG_CREATE_TIME ASC
	</select>

	<!-- 根据子标签查找父标签集合 -->
	<select id="queryParentTagsByCode" resultMap="BaseResultMap" parameterType="java.lang.String">
	SELECT 
		TAG_ID,
		TAG_CODE,
		TAG_NAME
	FROM 
		BP_INFO_TAG
	WHERE 
		TAG_PARENT_ID is null
	AND 
		TAG_State = '1'
	<if test="_parameter!=null">
		and TAG_MODULE = #{_parameter,jdbcType=VARCHAR}
	</if>
	ORDER BY TAG_CREATE_TIME ASC
	</select>

	<!-- 根据父标签查找子标签集合 -->
	<select id="queryParentTagsByChildCode" resultMap="BaseResultMap" parameterType="java.lang.String">
		SELECT
		TAG_ID,
		TAG_CODE,
		TAG_NAME
		FROM
		BP_INFO_TAG
		WHERE
		TAG_PARENT_ID is not null
		AND
		TAG_State = '1'
		<if test="_parameter!=null">
			and TAG_MODULE = #{_parameter,jdbcType=VARCHAR}
		</if>
		ORDER BY TAG_CREATE_TIME ASC
	</select>
	
	<!-- 根据子标签查找子标签列表 -->
	<select id="queryChildTagsByChildCode" resultMap="BaseResultMap"
		parameterType="java.lang.String">
	SELECT
		TAG_NAME,
		TAG_CODE
	FROM
		BP_INFO_TAG PBIT
	WHERE 
		PBIT.TAG_PARENT_ID = 
	(SELECT 
		BIT.TAG_PARENT_ID
	FROM
		BP_INFO_TAG AS BIT
	WHERE
		BIT.TAG_CODE = #{infoTagCode,jdbcType=VARCHAR}
	AND
		BIT.TAG_State = '1')
	AND
		PBIT.TAG_State = '1'
	ORDER BY TAG_CREATE_TIME ASC
	</select>

	<!--根据子标签查找父标签  -->
	<select id="queryParentTagByCode" parameterType="java.lang.String" resultMap="BaseResultMap">
	SELECT 
		PBIT.TAG_CODE,
		PBIT.TAG_NAME
	FROM
		BP_INFO_TAG AS BIT
	LEFT JOIN
		BP_INFO_TAG AS PBIT
	ON
		BIT.TAG_PARENT_ID = PBIT.TAG_ID
	WHERE
		BIT.TAG_CODE = #{infoTagCode,jdbcType=VARCHAR}
	AND 
		BIT.TAG_STATE ='1'
	AND
		PBIT.TAG_STATE ='1'
	</select>
</mapper>