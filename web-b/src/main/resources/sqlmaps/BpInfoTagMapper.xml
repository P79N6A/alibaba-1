<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sun3d.why.dao.BpInfoTagMapper">
	<resultMap id="BaseResultMap" type="com.sun3d.why.model.BpInfoTag">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Aug 15 
			11:31:29 CST 2017. -->
		<id column="TAG_ID" property="tagId" jdbcType="VARCHAR" />
		<result column="TAG_NAME" property="tagName" jdbcType="VARCHAR" />
		<result column="TAG_SUBTAG" property="subTag" jdbcType="VARCHAR" />
		<result column="TAG_PARENT_ID" property="tagParentId" jdbcType="VARCHAR" />
		<result column="TAG_CODE" property="tagCode" jdbcType="VARCHAR" />
		<result column="TAG_STATE" property="tagState" jdbcType="INTEGER" />
		<result column="TAG_CREATE_USER" property="tagCreateUser"
			jdbcType="VARCHAR" />
		<result column="TAG_UPDATE_USER" property="tagUpdateUser"
			jdbcType="VARCHAR" />
		<result column="TAG_CREATE_TIME" property="tagCreateTime"
			jdbcType="TIMESTAMP" />
		<result column="TAG_UPDATE_TIME" property="tagUpdateTime"
			jdbcType="TIMESTAMP" />
		<result column="TAG_AMOUNT" property="tagAmount"
			jdbcType="INTEGER" />
		<result column="TAG_MODULE" jdbcType="VARCHAR"
				property="module" />
		<result column="user_account" property="userAccount" jdbcType="VARCHAR" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Aug 15 
			11:31:29 CST 2017. -->
		TAG_ID, TAG_NAME,TAG_SUBTAG, TAG_PARENT_ID, TAG_STATE,TAG_AMOUNT,TAG_CODE,
		TAG_CREATE_USER,
		TAG_UPDATE_USER, TAG_CREATE_TIME, TAG_UPDATE_TIME,TAG_MODULE
	</sql>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.String">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Aug 15 
			11:31:29 CST 2017. -->
		select
		<include refid="Base_Column_List" />
		from bp_info_tag
		where TAG_ID = #{tagId,jdbcType=VARCHAR}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.String">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Aug 15 
			11:31:29 CST 2017. -->
		delete from bp_info_tag
		where TAG_ID = #{tagId,jdbcType=VARCHAR}
	</delete>
	<insert id="insert" parameterType="com.sun3d.why.model.BpInfoTag">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Aug 15 
			11:31:29 CST 2017. -->
		insert into bp_info_tag (TAG_ID, TAG_NAME,
		TAG_PARENT_ID,TAG_CODE,
		TAG_STATE,TAG_AMOUNT,
		TAG_CREATE_USER, TAG_UPDATE_USER,
		TAG_CREATE_TIME,
		TAG_UPDATE_TIME,
		TAG_MODULE)
		values (#{tagId,jdbcType=VARCHAR},
		#{tagName,jdbcType=VARCHAR},
		#{tagParentId,jdbcType=VARCHAR}, #{tagState,jdbcType=INTEGER},#{tagAmount,jdbcType=INTEGER},
		#{tagCreateUser,jdbcType=VARCHAR},
		#{tagUpdateUser,jdbcType=VARCHAR},
		#{tagCreateTime,jdbcType=TIMESTAMP},
		#{tagUpdateTime,jdbcType=TIMESTAMP},
		#{module,jdbcType=VARCHAR})
	</insert>
	<insert id="insertSelective" parameterType="com.sun3d.why.model.BpInfoTag">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Aug 15 
			11:31:29 CST 2017. -->
		insert into bp_info_tag
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="tagId != null">
				TAG_ID,
			</if>
			<if test="tagName != null">
				TAG_NAME,
			</if>
			<if test="subTag != null">
				TAG_SUBTAG,
			</if>
			<if test="tagCode != null">
				TAG_CODE,
			</if>
			<if test="tagParentId != null">
				TAG_PARENT_ID,
			</if>
			<if test="tagState != null">
				TAG_STATE,
			</if>
			<if test="tagAmount != null">
				TAG_AMOUNT,
			</if>
			<if test="tagCreateUser != null">
				TAG_CREATE_USER,
			</if>
			<if test="tagUpdateUser != null">
				TAG_UPDATE_USER,
			</if>
			<if test="tagCreateTime != null">
				TAG_CREATE_TIME,
			</if>
			<if test="tagUpdateTime != null">
				TAG_UPDATE_TIME,
			</if>
			<if test="module != null">
				TAG_MODULE,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="tagId != null">
				#{tagId,jdbcType=VARCHAR},
			</if>
			<if test="tagName != null">
				#{tagName,jdbcType=VARCHAR},
			</if>
			<if test="subTag != null">
				#{subTag,jdbcType=VARCHAR},
			</if>
			<if test="tagCode != null">
				#{tagCode,jdbcType=VARCHAR},
			</if>
			<if test="tagParentId != null">
				#{tagParentId,jdbcType=VARCHAR},
			</if>
			<if test="tagState != null">
				#{tagState,jdbcType=INTEGER},
			</if>
			<if test="tagAmount != null">
				#{tagAmount,jdbcType=INTEGER},
			</if>
			<if test="tagCreateUser != null">
				#{tagCreateUser,jdbcType=VARCHAR},
			</if>
			<if test="tagUpdateUser != null">
				#{tagUpdateUser,jdbcType=VARCHAR},
			</if>
			<if test="tagCreateTime != null">
				#{tagCreateTime,jdbcType=TIMESTAMP},
			</if>
			<if test="tagUpdateTime != null">
				#{tagUpdateTime,jdbcType=TIMESTAMP},
			</if>
			<if test="module != null">
				#{module,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.sun3d.why.model.BpInfoTag">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Aug 15 
			11:31:29 CST 2017. -->
		update bp_info_tag
		<set>
			<if test="tagName != null">
				TAG_NAME = #{tagName,jdbcType=VARCHAR},
			</if>
			<if test="subTag != null">
				TAG_SUBTAG = #{subTag,jdbcType=VARCHAR},
			</if>
			<if test="tagCode != null">
				TAG_CODE = #{tagCode,jdbcType=VARCHAR},
			</if>
			<if test="tagParentId != null">
				TAG_PARENT_ID = #{tagParentId,jdbcType=VARCHAR},
			</if>
			<if test="tagState != null">
				TAG_STATE = #{tagState,jdbcType=INTEGER},
			</if>
			<if test="tagAmount != null">
				TAG_AMOUNT = #{tagAmount,jdbcType=INTEGER},
			</if>
			<if test="tagCreateUser != null">
				TAG_CREATE_USER = #{tagCreateUser,jdbcType=VARCHAR},
			</if>
			<if test="tagUpdateUser != null">
				TAG_UPDATE_USER = #{tagUpdateUser,jdbcType=VARCHAR},
			</if>
			<if test="tagCreateTime != null">
				TAG_CREATE_TIME = #{tagCreateTime,jdbcType=TIMESTAMP},
			</if>
			<if test="tagUpdateTime != null">
				TAG_UPDATE_TIME = #{tagUpdateTime,jdbcType=TIMESTAMP},
			</if>
		</set>
		where TAG_ID = #{tagId,jdbcType=VARCHAR}
		<if test="module != null">
			and TAG_MODULE = #{module,jdbcType=VARCHAR}
		</if>
	</update>
	<update id="updateByPrimaryKey" parameterType="com.sun3d.why.model.BpInfoTag">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Aug 15 
			11:31:29 CST 2017. -->
		update bp_info_tag
		set 
		TAG_NAME = #{tagName,jdbcType=VARCHAR},
		TAG_SUBTAG = #{subTag,jdbcType=VARCHAR},
		TAG_CODE = #{tagCode,jdbcType=VARCHAR},
		TAG_PARENT_ID =
		#{tagParentId,jdbcType=VARCHAR},
		TAG_STATE =
		#{tagState,jdbcType=INTEGER},
		TAG_AMOUNT =
		#{tagSAmount,jdbcType=INTEGER},
		TAG_CREATE_USER =
		#{tagCreateUser,jdbcType=VARCHAR},
		TAG_UPDATE_USER =
		#{tagUpdateUser,jdbcType=VARCHAR},
		TAG_CREATE_TIME =
		#{tagCreateTime,jdbcType=TIMESTAMP},
		TAG_UPDATE_TIME =
		#{tagUpdateTime,jdbcType=TIMESTAMP}
		where TAG_ID =
		#{tagId,jdbcType=VARCHAR}
		and TAG_MODULE = #{module,jdbcType=VARCHAR}
	</update>

	<!-- 根据条件查询出总数 -->
	<select id="queryTotal" parameterType="java.util.Map"
		resultType="java.lang.Integer">
		SELECT
		COUNT(*)
		FROM
		BP_INFO_TAG
		<where>
			TAG_STATE != '2'
			<if test="tagName!=null and tagName != ''">
				and TAG_NAME like
				CONCAT('%',#{tagName,jdbcType=VARCHAR},'%')
			</if>
			<if test="module!=null">
				and TAG_MODULE = #{module,jdbcType=VARCHAR}
			</if>
		</where>
	</select>

	<!-- 根据条件查询出当前页数据集合 -->
	<select id="queryListByMap" parameterType="java.util.Map"
		resultMap="BaseResultMap">
		SELECT
		BIT.TAG_ID,
		BIT.TAG_NAME,
		BIT.TAG_CODE,
		BIT.TAG_CREATE_USER,
		BIT.TAG_UPDATE_TIME,
		BIT.TAG_MODULE,
		BIT.TAG_AMOUNT,
		SU.USER_ACCOUNT AS
		USER_ACCOUNT
		FROM
		BP_INFO_TAG
		BIT,
		SYS_USER SU
		<where>
			TAG_STATE != '2'
			AND
			SU.USER_ID=BIT.TAG_CREATE_USER
			<if test="tagName != null and tagName != ''">
				and TAG_NAME like
				CONCAT('%',#{tagName,jdbcType=VARCHAR},'%')
			</if>
			<if test="module!=null">
				and TAG_MODULE = #{module,jdbcType=VARCHAR}
			</if>
			ORDER BY BIT.TAG_UPDATE_TIME DESC
			<if test="firstResult != null">
				limit ${firstResult},${rows}
			</if>
		</where>
	</select>
	
	<!-- 根据状态,parentId为空查询字典列表信息 -->
	<select id="queryPTagByStatus" resultMap="BaseResultMap" parameterType="java.util.Map" >
		SELECT 
			TAG_ID,
			TAG_NAME
		FROM 
			BP_INFO_TAG
		WHERE 
			TAG_PARENT_ID is null
		<if test="tagState != null" >
			AND 
				TAG_State	= #{tagState,jdbcType=INTEGER}
		</if>
		ORDER BY TAG_UPDATE_TIME DESC
	</select>
	
	<!-- 查找子标签 -->
	<select id="queryListByParentId" parameterType="java.lang.String" resultMap="BaseResultMap" >
		SELECT 
			TAG_ID,
			TAG_NAME,
			TAG_MODULE,
			TAG_CODE
		FROM 
			BP_INFO_TAG
		WHERE 
			TAG_STATE != 2 
			and TAG_PARENT_ID = #{parentId,jdbcType=INTEGER}
		ORDER BY TAG_UPDATE_TIME DESC
	</select>
	
	<select id="queryParentTagByInfoId" resultMap="BaseResultMap"
		parameterType="java.lang.String">
		SELECT
			PBIT.TAG_ID,
			PBIT.TAG_AMOUNT
		FROM 
			BP_INFO AS BI
		LEFT JOIN
			BP_INFO_TAG AS BIT
		ON
			BI.BEIPIAOINFO_TAG = BIT.TAG_ID
		LEFT JOIN
			BP_INFO_TAG AS PBIT
		ON
			BIT.TAG_PARENT_ID = PBIT.TAG_ID
		WHERE
			BI.BEIPIAOINFO_ID = #{infoId,jdbcType=VARCHAR}
	</select>
	
	<select id="queryChildTagByParentId" resultMap="BaseResultMap"
		parameterType="java.lang.String" >
		SELECT
			BIT.TAG_ID
		FROM
			BP_INFO_TAG AS BIT
		WHERE
			BIT.TAG_PARENT_ID = #{tagId,jdbcType=VARCHAR}
	</select>

	<select id="queryChildTagByTagCode" resultMap="BaseResultMap"
			parameterType="java.lang.String" >
		SELECT
			BIT.TAG_CODE,
			BIT.TAG_ID,
			BIT.TAG_NAME
		FROM
			BP_INFO_TAG AS BIT
		WHERE
			BIT.TAG_CODE = #{tagCode,jdbcType=VARCHAR}
	</select>

	<select id="queryTagsByModule" resultMap="BaseResultMap"
			parameterType="java.lang.String" >
		SELECT
			BIT.TAG_CODE,
			BIT.TAG_ID,
			BIT.TAG_NAME
		FROM
			BP_INFO_TAG AS BIT
		WHERE
			BIT.TAG_MODULE = #{module,jdbcType=VARCHAR}
			and BIT.TAG_PARENT_ID is NULL
	</select>

	<!-- 根据父标签编码查找子标签编码集合 -->
	<select id="queryChildTagByCode" resultMap="BaseResultMap"
			parameterType="java.lang.String" >
	SELECT
		BIT.TAG_CODE,
		BIT.TAG_ID,
		BIT.TAG_NAME
	FROM
		BP_INFO_TAG AS BIT
	LEFT JOIN
		BP_INFO_TAG AS PBIT
	ON
		BIT.TAG_PARENT_ID = PBIT.TAG_ID
	WHERE
		PBIT.TAG_MODULE = #{module,jdbcType=VARCHAR}
	AND
		BIT.TAG_STATE ='1'
	AND
		PBIT.TAG_STATE ='1'
	ORDER BY
		BIT.TAG_CREATE_TIME ASC
	</select>

</mapper>