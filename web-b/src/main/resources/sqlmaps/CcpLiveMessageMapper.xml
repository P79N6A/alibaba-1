<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sun3d.why.dao.CcpLiveMessageMapper" >
  <resultMap id="BaseResultMap" type="com.culturecloud.model.bean.live.CcpLiveMessage" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Oct 19 13:29:59 CST 2016.
    -->
    <id column="message_id" property="messageId" jdbcType="VARCHAR" />
    <result column="message_content" property="messageContent" jdbcType="VARCHAR" />
    <result column="message_create_user" property="messageCreateUser" jdbcType="VARCHAR" />
    <result column="message_create_time" property="messageCreateTime" jdbcType="TIMESTAMP" />
    <result column="message_update_time" property="messageUpdateTime" jdbcType="TIMESTAMP" />
    <result column="message_activity" property="messageActivity" jdbcType="VARCHAR" />
    <result column="message_is_top" property="messageIsTop" jdbcType="INTEGER" />
    <result column="message_is_del" property="messageIsDel" jdbcType="INTEGER" />
     <result column="message_is_interaction" jdbcType="INTEGER" property="messageIsInteraction" />
    <result column="message_is_recommend" jdbcType="INTEGER" property="messageIsRecommend" />
    <result column="message_recommend_time" jdbcType="TIMESTAMP" property="messageRecommendTime" />
    <result column="sort_time" jdbcType="BIGINT" property="sortTime" />
  </resultMap>
  <resultMap id="ResultMapWithBLOBs" type="com.culturecloud.model.bean.live.CcpLiveMessage" extends="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Oct 19 13:29:59 CST 2016.
    -->
    <result column="message_img" property="messageImg" jdbcType="LONGVARCHAR" />
  </resultMap>
  
  <resultMap type="com.sun3d.why.dao.dto.CcpLiveMessageDto" id="BaseResultDtoMap" extends="ResultMapWithBLOBs">
  	<result column="USER_NICK_NAME" property="messageCreateUserName" jdbcType="VARCHAR"/>
  </resultMap>
  
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Oct 19 13:29:59 CST 2016.
    -->
    message_id, message_content, message_create_user, message_create_time, message_update_time, 
    message_activity, message_is_top, message_is_del, message_is_interaction, message_is_recommend, 
    message_recommend_time, sort_time
  </sql>
  <sql id="Blob_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Oct 19 13:29:59 CST 2016.
    -->
      message_img, message_video
  </sql>
  
  <select id="queryLiveMessageCountByCondition" resultType="java.lang.Integer" parameterType="java.util.Map">
  	
  	 select count(*)
  
   	from ccp_live_message m
   	
    left join ccp_live_activity a on a.live_activity_id = m.message_activity 
   	
   	where 1=1 

	 <if test="messageActivity != null" >
       and message_activity= #{messageActivity,jdbcType=VARCHAR}
      </if>
      
      <if test="messageIsInteraction != null">
      and message_is_interaction=#{messageIsInteraction}
      </if>
      
        <if test="liveActvityName !=null">
        and a.live_title = #{liveActvityName}
        </if>
        
        <if test="liveCreateUser != null">
		and a.live_create_user=#{liveCreateUser}
		</if>
   
      and message_is_del = 1
  </select>
  
  <select id="queryLiveMessageByCondition" resultMap="BaseResultDtoMap" parameterType="java.util.Map" >
  	 select m.*,
  	 
	IF(m.message_is_interaction=1,u.user_name,s.USER_NICK_NAME) AS USER_NICK_NAME,

	IF(m.message_is_interaction=1,u.USER_HEAD_IMG_URL,s.USER_HEAD_IMG_URL) AS userHeadImgUrl , 
	
	a.live_title as liveActivityName
    
      from ccp_live_message m
      
      left join ccp_live_activity a on a.live_activity_id = m.message_activity 
      
	LEFT JOIN cms_terminal_user u ON u.user_id=m.message_create_user

	LEFT JOIN sys_user s ON s.user_id=m.message_create_user
      
      where 1=1 

	 <if test="messageActivity != null" >
       and message_activity= #{messageActivity,jdbcType=VARCHAR}
      </if>
      
      <if test="messageIsInteraction != null">
      and message_is_interaction=#{messageIsInteraction}
      </if>
      
      <if test="liveActvityName !=null">
        and a.live_title = #{liveActvityName}
        </if>
        
          <if test="liveCreateUser != null">
		and a.live_create_user=#{liveCreateUser}
		</if>
      
      and message_is_del = 1
      
      ORDER BY message_create_time DESC
	<if test="firstResult != null">
        limit ${firstResult},${rows}
    </if>
  </select>
  
  <update id="setMessageTop" parameterType="java.util.Map">
  	
  	 update ccp_live_message 
    <set >
    
    	message_is_top = 
      
        case message_id when  #{messageId,jdbcType=VARCHAR}  then 1 
        
        else 0 
        
        end 
    </set>
  	  where 1=1 
    
	 <if test="messageActivity != null" >
       and message_activity= #{messageActivity,jdbcType=VARCHAR}
      </if>
  </update>
  
  <select id="selectByPrimaryKey" resultMap="ResultMapWithBLOBs" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Oct 19 13:29:59 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from ccp_live_message
    where message_id = #{messageId,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Oct 19 13:29:59 CST 2016.
    -->
    delete from ccp_live_message
    where message_id = #{messageId,jdbcType=VARCHAR}
  </delete>
    <insert id="insert" parameterType="com.culturecloud.model.bean.live.CcpLiveMessage">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 16 21:23:20 CST 2017.
    -->
    insert into ccp_live_message (message_id, message_content, message_create_user, 
      message_create_time, message_update_time, 
      message_activity, message_is_top, message_is_del, 
      message_is_interaction, message_is_recommend, 
      message_recommend_time, sort_time, message_img, 
      message_video)
    values (#{messageId,jdbcType=VARCHAR}, #{messageContent,jdbcType=VARCHAR}, #{messageCreateUser,jdbcType=VARCHAR}, 
      #{messageCreateTime,jdbcType=TIMESTAMP}, #{messageUpdateTime,jdbcType=TIMESTAMP}, 
      #{messageActivity,jdbcType=VARCHAR}, #{messageIsTop,jdbcType=INTEGER}, #{messageIsDel,jdbcType=INTEGER}, 
      #{messageIsInteraction,jdbcType=INTEGER}, #{messageIsRecommend,jdbcType=INTEGER}, 
      #{messageRecommendTime,jdbcType=TIMESTAMP}, #{sortTime,jdbcType=BIGINT}, #{messageImg,jdbcType=LONGVARCHAR}, 
      #{messageVideo,jdbcType=LONGVARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.culturecloud.model.bean.live.CcpLiveMessage">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 16 21:23:20 CST 2017.
    -->
    insert into ccp_live_message
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="messageId != null">
        message_id,
      </if>
      <if test="messageContent != null">
        message_content,
      </if>
      <if test="messageCreateUser != null">
        message_create_user,
      </if>
      <if test="messageCreateTime != null">
        message_create_time,
      </if>
      <if test="messageUpdateTime != null">
        message_update_time,
      </if>
      <if test="messageActivity != null">
        message_activity,
      </if>
      <if test="messageIsTop != null">
        message_is_top,
      </if>
      <if test="messageIsDel != null">
        message_is_del,
      </if>
      <if test="messageIsInteraction != null">
        message_is_interaction,
      </if>
      <if test="messageIsRecommend != null">
        message_is_recommend,
      </if>
      <if test="messageRecommendTime != null">
        message_recommend_time,
      </if>
      <if test="sortTime != null">
        sort_time,
      </if>
      <if test="messageImg != null">
        message_img,
      </if>
      <if test="messageVideo != null">
        message_video,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="messageId != null">
        #{messageId,jdbcType=VARCHAR},
      </if>
      <if test="messageContent != null">
        #{messageContent,jdbcType=VARCHAR},
      </if>
      <if test="messageCreateUser != null">
        #{messageCreateUser,jdbcType=VARCHAR},
      </if>
      <if test="messageCreateTime != null">
        #{messageCreateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="messageUpdateTime != null">
        #{messageUpdateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="messageActivity != null">
        #{messageActivity,jdbcType=VARCHAR},
      </if>
      <if test="messageIsTop != null">
        #{messageIsTop,jdbcType=INTEGER},
      </if>
      <if test="messageIsDel != null">
        #{messageIsDel,jdbcType=INTEGER},
      </if>
      <if test="messageIsInteraction != null">
        #{messageIsInteraction,jdbcType=INTEGER},
      </if>
      <if test="messageIsRecommend != null">
        #{messageIsRecommend,jdbcType=INTEGER},
      </if>
      <if test="messageRecommendTime != null">
        #{messageRecommendTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sortTime != null">
        #{sortTime,jdbcType=BIGINT},
      </if>
      <if test="messageImg != null">
        #{messageImg,jdbcType=LONGVARCHAR},
      </if>
      <if test="messageVideo != null">
        #{messageVideo,jdbcType=LONGVARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.culturecloud.model.bean.live.CcpLiveMessage">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 16 21:23:20 CST 2017.
    -->
    update ccp_live_message
    <set>
      <if test="messageContent != null">
        message_content = #{messageContent,jdbcType=VARCHAR},
      </if>
      <if test="messageCreateUser != null">
        message_create_user = #{messageCreateUser,jdbcType=VARCHAR},
      </if>
      <if test="messageCreateTime != null">
        message_create_time = #{messageCreateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="messageUpdateTime != null">
        message_update_time = #{messageUpdateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="messageActivity != null">
        message_activity = #{messageActivity,jdbcType=VARCHAR},
      </if>
      <if test="messageIsTop != null">
        message_is_top = #{messageIsTop,jdbcType=INTEGER},
      </if>
      <if test="messageIsDel != null">
        message_is_del = #{messageIsDel,jdbcType=INTEGER},
      </if>
      <if test="messageIsInteraction != null">
        message_is_interaction = #{messageIsInteraction,jdbcType=INTEGER},
      </if>
      <if test="messageIsRecommend != null">
        message_is_recommend = #{messageIsRecommend,jdbcType=INTEGER},
      </if>
      <if test="messageRecommendTime != null">
        message_recommend_time = #{messageRecommendTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sortTime != null">
        sort_time = #{sortTime,jdbcType=BIGINT},
      </if>
      <if test="messageImg != null">
        message_img = #{messageImg,jdbcType=LONGVARCHAR},
      </if>
      <if test="messageVideo != null">
        message_video = #{messageVideo,jdbcType=LONGVARCHAR},
      </if>
    </set>
    where message_id = #{messageId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.culturecloud.model.bean.live.CcpLiveMessage">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 16 21:23:20 CST 2017.
    -->
    update ccp_live_message
    set message_content = #{messageContent,jdbcType=VARCHAR},
      message_create_user = #{messageCreateUser,jdbcType=VARCHAR},
      message_create_time = #{messageCreateTime,jdbcType=TIMESTAMP},
      message_update_time = #{messageUpdateTime,jdbcType=TIMESTAMP},
      message_activity = #{messageActivity,jdbcType=VARCHAR},
      message_is_top = #{messageIsTop,jdbcType=INTEGER},
      message_is_del = #{messageIsDel,jdbcType=INTEGER},
      message_is_interaction = #{messageIsInteraction,jdbcType=INTEGER},
      message_is_recommend = #{messageIsRecommend,jdbcType=INTEGER},
      message_recommend_time = #{messageRecommendTime,jdbcType=TIMESTAMP},
      sort_time = #{sortTime,jdbcType=BIGINT},
      message_img = #{messageImg,jdbcType=LONGVARCHAR},
      message_video = #{messageVideo,jdbcType=LONGVARCHAR}
    where message_id = #{messageId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.culturecloud.model.bean.live.CcpLiveMessage">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jan 16 21:23:20 CST 2017.
    -->
    update ccp_live_message
    set message_content = #{messageContent,jdbcType=VARCHAR},
      message_create_user = #{messageCreateUser,jdbcType=VARCHAR},
      message_create_time = #{messageCreateTime,jdbcType=TIMESTAMP},
      message_update_time = #{messageUpdateTime,jdbcType=TIMESTAMP},
      message_activity = #{messageActivity,jdbcType=VARCHAR},
      message_is_top = #{messageIsTop,jdbcType=INTEGER},
      message_is_del = #{messageIsDel,jdbcType=INTEGER},
      message_is_interaction = #{messageIsInteraction,jdbcType=INTEGER},
      message_is_recommend = #{messageIsRecommend,jdbcType=INTEGER},
      message_recommend_time = #{messageRecommendTime,jdbcType=TIMESTAMP},
      sort_time = #{sortTime,jdbcType=BIGINT}
    where message_id = #{messageId,jdbcType=VARCHAR}
  </update>
</mapper>