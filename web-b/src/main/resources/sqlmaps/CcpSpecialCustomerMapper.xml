<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sun3d.why.dao.CcpSpecialCustomerMapper">
  <resultMap id="BaseResultMap" type="com.culturecloud.model.bean.special.CcpSpecialCustomer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 27 14:52:35 CST 2016.
    -->
    <id column="customer_id" jdbcType="VARCHAR" property="customerId" />
    <result column="customer_name" jdbcType="VARCHAR" property="customerName" />
    <result column="customer_type" jdbcType="VARCHAR" property="customerType" />
    <result column="customer_is_del" jdbcType="INTEGER" property="customerIsDel" />
    <result column="ycode_num" jdbcType="INTEGER" property="ycodeNum" />
    <result column="project_id" jdbcType="VARCHAR" property="projectId" />
    <result column="page_id" jdbcType="VARCHAR" property="pageId" />
    <result column="enter_id" jdbcType="VARCHAR" property="enterId" />
    <result column="enter_logo_image_url" jdbcType="VARCHAR" property="enterLogoImageUrl"/>
    <result column="customer_create_time" jdbcType="TIMESTAMP" property="customerCreateTime" />
    <result column="customer_create_user" jdbcType="VARCHAR" property="customerCreateUser" />
    <result column="ycode_start_time" jdbcType="TIMESTAMP" property="ycodeStartTime" />
    <result column="ycode_end_time" jdbcType="TIMESTAMP" property="ycodeEndTime" />
    <result column="customer_update_time" jdbcType="TIMESTAMP" property="customerUpdateTime" />
    <result column="customer_update_user" jdbcType="VARCHAR" property="customerUpdateUser" />
  </resultMap>
  
  <resultMap type="com.sun3d.why.dao.dto.CcpSpecialCustomerDto" id="BaseResultDtoMap" extends="BaseResultMap">
  	 <result column="project_name" jdbcType="VARCHAR" property="projectName" />
  	 <result column="enter_name" jdbcType="VARCHAR" property="enterName" />
  	 <result column="page_name" jdbcType="VARCHAR" property="pageName" />
  	 <result column="enter_parame_path" jdbcType="VARCHAR" property="enterParamePath"/>
  	 <result column="customer_create_user_name" property="customerCreateUserName" jdbcType="VARCHAR" />
  	 
  </resultMap>
  
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 27 14:52:35 CST 2016.
    -->
    customer_id, customer_name, customer_type, customer_is_del, ycode_num, project_id, 
    page_id, enter_id, customer_create_time, customer_create_user, ycode_start_time, 
    ycode_end_time, customer_update_time, customer_update_user
  </sql>
  
    <select id="queryCustomerCountByCondition" parameterType="java.util.Map"
		resultType="java.lang.Integer">
		select count(*) 
		from ccp_special_customer c
		where 1=1
	    <if test="customerIsDel != null">
	    	and customer_is_del=#{customerIsDel}
	    </if>
	</select>
  
  <select id="queryCustomerByCondition"  resultMap="BaseResultDtoMap" parameterType="java.lang.String">
  
    select 
    customer_id, customer_name, customer_type, customer_is_del, ycode_num, c.project_id, 
    c.page_id, c.enter_id, customer_create_time, customer_create_user, ycode_start_time, 
    ycode_end_time, customer_update_time, customer_update_user,sp.project_name,p.page_name,
    e.enter_name,e.enter_parame_path,u.USER_ACCOUNT as customer_create_user_name,e.enter_logo_image_url
    from ccp_special_customer c
    LEFT JOIN ccp_special_project sp on sp.project_id = c. project_id
    LEFT JOIN ccp_special_page p on p.page_id = c. page_id
    LEFT JOIN ccp_special_enter e on e.enter_id = c. enter_id
    LEFT JOIN SYS_USER u ON u.USER_ID = c.customer_create_user 
     where 1=1
    <if test="customerIsDel != null">
    	and customer_is_del=#{customerIsDel}
    </if>
     order by customer_create_time
    <if test="firstResult != null">
      limit #{firstResult},#{rows}
  </if>
  </select>
  
  <select id="querySumYCodeCount" resultType="java.lang.Integer" parameterType="java.lang.String">
  	SELECT IFNULL(SUM(b.ORDER_COUNT),0) 
FROM cms_activity a left join cms_activity_event as b on a.ACTIVITY_ID=b.ACTIVITY_ID
WHERE a.ACTIVITY_ID IN (SELECT pa.activity_id 
FROM ccp_special_page_activity pa 
WHERE pa.page_id=(SELECT c.page_id FROM ccp_special_customer c WHERE c.customer_id=#{customerId}) )
AND a.ACTIVITY_IS_DEL=1
  </select>
  
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 27 14:52:35 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from ccp_special_customer
    where customer_id = #{customerId,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 27 14:52:35 CST 2016.
    -->
    delete from ccp_special_customer
    where customer_id = #{customerId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.culturecloud.model.bean.special.CcpSpecialCustomer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 27 14:52:35 CST 2016.
    -->
    insert into ccp_special_customer (customer_id, customer_name, customer_type, 
      customer_is_del, ycode_num, project_id, 
      page_id, enter_id, customer_create_time, 
      customer_create_user, ycode_start_time, ycode_end_time, 
      customer_update_time, customer_update_user
      )
    values (#{customerId,jdbcType=VARCHAR}, #{customerName,jdbcType=VARCHAR}, #{customerType,jdbcType=VARCHAR}, 
      #{customerIsDel,jdbcType=INTEGER}, #{ycodeNum,jdbcType=INTEGER}, #{projectId,jdbcType=VARCHAR}, 
      #{pageId,jdbcType=VARCHAR}, #{enterId,jdbcType=VARCHAR}, #{customerCreateTime,jdbcType=TIMESTAMP}, 
      #{customerCreateUser,jdbcType=VARCHAR}, #{ycodeStartTime,jdbcType=TIMESTAMP}, #{ycodeEndTime,jdbcType=TIMESTAMP}, 
      #{customerUpdateTime,jdbcType=TIMESTAMP}, #{customerUpdateUser,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.culturecloud.model.bean.special.CcpSpecialCustomer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 27 14:52:35 CST 2016.
    -->
    insert into ccp_special_customer
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="customerId != null">
        customer_id,
      </if>
      <if test="customerName != null">
        customer_name,
      </if>
      <if test="customerType != null">
        customer_type,
      </if>
      <if test="customerIsDel != null">
        customer_is_del,
      </if>
      <if test="ycodeNum != null">
        ycode_num,
      </if>
      <if test="projectId != null">
        project_id,
      </if>
      <if test="pageId != null">
        page_id,
      </if>
      <if test="enterId != null">
        enter_id,
      </if>
      <if test="customerCreateTime != null">
        customer_create_time,
      </if>
      <if test="customerCreateUser != null">
        customer_create_user,
      </if>
      <if test="ycodeStartTime != null">
        ycode_start_time,
      </if>
      <if test="ycodeEndTime != null">
        ycode_end_time,
      </if>
      <if test="customerUpdateTime != null">
        customer_update_time,
      </if>
      <if test="customerUpdateUser != null">
        customer_update_user,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="customerId != null">
        #{customerId,jdbcType=VARCHAR},
      </if>
      <if test="customerName != null">
        #{customerName,jdbcType=VARCHAR},
      </if>
      <if test="customerType != null">
        #{customerType,jdbcType=VARCHAR},
      </if>
      <if test="customerIsDel != null">
        #{customerIsDel,jdbcType=INTEGER},
      </if>
      <if test="ycodeNum != null">
        #{ycodeNum,jdbcType=INTEGER},
      </if>
      <if test="projectId != null">
        #{projectId,jdbcType=VARCHAR},
      </if>
      <if test="pageId != null">
        #{pageId,jdbcType=VARCHAR},
      </if>
      <if test="enterId != null">
        #{enterId,jdbcType=VARCHAR},
      </if>
      <if test="customerCreateTime != null">
        #{customerCreateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="customerCreateUser != null">
        #{customerCreateUser,jdbcType=VARCHAR},
      </if>
      <if test="ycodeStartTime != null">
        #{ycodeStartTime,jdbcType=TIMESTAMP},
      </if>
      <if test="ycodeEndTime != null">
        #{ycodeEndTime,jdbcType=TIMESTAMP},
      </if>
      <if test="customerUpdateTime != null">
        #{customerUpdateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="customerUpdateUser != null">
        #{customerUpdateUser,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.culturecloud.model.bean.special.CcpSpecialCustomer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 27 14:52:35 CST 2016.
    -->
    update ccp_special_customer
    <set>
      <if test="customerName != null">
        customer_name = #{customerName,jdbcType=VARCHAR},
      </if>
      <if test="customerType != null">
        customer_type = #{customerType,jdbcType=VARCHAR},
      </if>
      <if test="customerIsDel != null">
        customer_is_del = #{customerIsDel,jdbcType=INTEGER},
      </if>
      <if test="ycodeNum != null">
        ycode_num = #{ycodeNum,jdbcType=INTEGER},
      </if>
      <if test="projectId != null">
        project_id = #{projectId,jdbcType=VARCHAR},
      </if>
      <if test="pageId != null">
        page_id = #{pageId,jdbcType=VARCHAR},
      </if>
      <if test="enterId != null">
        enter_id = #{enterId,jdbcType=VARCHAR},
      </if>
      <if test="customerCreateTime != null">
        customer_create_time = #{customerCreateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="customerCreateUser != null">
        customer_create_user = #{customerCreateUser,jdbcType=VARCHAR},
      </if>
      <if test="ycodeStartTime != null">
        ycode_start_time = #{ycodeStartTime,jdbcType=TIMESTAMP},
      </if>
      <if test="ycodeEndTime != null">
        ycode_end_time = #{ycodeEndTime,jdbcType=TIMESTAMP},
      </if>
      <if test="customerUpdateTime != null">
        customer_update_time = #{customerUpdateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="customerUpdateUser != null">
        customer_update_user = #{customerUpdateUser,jdbcType=VARCHAR},
      </if>
    </set>
    where customer_id = #{customerId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.culturecloud.model.bean.special.CcpSpecialCustomer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Sep 27 14:52:35 CST 2016.
    -->
    update ccp_special_customer
    set customer_name = #{customerName,jdbcType=VARCHAR},
      customer_type = #{customerType,jdbcType=VARCHAR},
      customer_is_del = #{customerIsDel,jdbcType=INTEGER},
      ycode_num = #{ycodeNum,jdbcType=INTEGER},
      project_id = #{projectId,jdbcType=VARCHAR},
      page_id = #{pageId,jdbcType=VARCHAR},
      enter_id = #{enterId,jdbcType=VARCHAR},
      customer_create_time = #{customerCreateTime,jdbcType=TIMESTAMP},
      customer_create_user = #{customerCreateUser,jdbcType=VARCHAR},
      ycode_start_time = #{ycodeStartTime,jdbcType=TIMESTAMP},
      ycode_end_time = #{ycodeEndTime,jdbcType=TIMESTAMP},
      customer_update_time = #{customerUpdateTime,jdbcType=TIMESTAMP},
      customer_update_user = #{customerUpdateUser,jdbcType=VARCHAR}
    where customer_id = #{customerId,jdbcType=VARCHAR}
  </update>
</mapper>