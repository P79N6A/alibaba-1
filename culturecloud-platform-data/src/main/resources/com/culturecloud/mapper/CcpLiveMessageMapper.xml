<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.culturecloud.dao.live.CcpLiveMessageMapper">
  <resultMap id="BaseResultMap" type="com.culturecloud.model.bean.live.CcpLiveMessage">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Feb 04 14:19:07 CST 2017.
    -->
    <id column="message_id" jdbcType="VARCHAR" property="messageId" />
    <result column="message_content" jdbcType="VARCHAR" property="messageContent" />
    <result column="message_create_user" jdbcType="VARCHAR" property="messageCreateUser" />
    <result column="message_create_time" jdbcType="TIMESTAMP" property="messageCreateTime" />
    <result column="message_update_time" jdbcType="TIMESTAMP" property="messageUpdateTime" />
    <result column="message_activity" jdbcType="VARCHAR" property="messageActivity" />
    <result column="message_is_top" jdbcType="INTEGER" property="messageIsTop" />
    <result column="message_is_del" jdbcType="INTEGER" property="messageIsDel" />
    <result column="message_is_interaction" jdbcType="INTEGER" property="messageIsInteraction" />
    <result column="message_is_recommend" jdbcType="INTEGER" property="messageIsRecommend" />
    <result column="message_recommend_time" jdbcType="TIMESTAMP" property="messageRecommendTime" />
    <result column="sort_time" jdbcType="BIGINT" property="sortTime" />
  </resultMap>
  <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="com.culturecloud.model.bean.live.CcpLiveMessage">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Feb 04 14:19:07 CST 2017.
    -->
    <result column="message_img" jdbcType="LONGVARCHAR" property="messageImg" />
    <result column="message_video" jdbcType="LONGVARCHAR" property="messageVideo" />
    <result column="message_video_img" jdbcType="LONGVARCHAR" property="messageVideoImg" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Feb 04 14:19:07 CST 2017.
    -->
    message_id, message_content, message_create_user, message_create_time, message_update_time, 
    message_activity, message_is_top, message_is_del, message_is_interaction, message_is_recommend, 
    message_recommend_time, sort_time
  </sql>
  <sql id="Blob_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Feb 04 14:19:07 CST 2017.
    -->
    message_img, message_video, message_video_img
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="ResultMapWithBLOBs">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Feb 04 14:19:07 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from ccp_live_message
    where message_id = #{messageId,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Feb 04 14:19:07 CST 2017.
    -->
    delete from ccp_live_message
    where message_id = #{messageId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.culturecloud.model.bean.live.CcpLiveMessage">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Feb 04 14:19:07 CST 2017.
    -->
    insert into ccp_live_message (message_id, message_content, message_create_user, 
      message_create_time, message_update_time, 
      message_activity, message_is_top, message_is_del, 
      message_is_interaction, message_is_recommend, 
      message_recommend_time, sort_time, message_img, 
      message_video, message_video_img)
    values (#{messageId,jdbcType=VARCHAR}, #{messageContent,jdbcType=VARCHAR}, #{messageCreateUser,jdbcType=VARCHAR}, 
      #{messageCreateTime,jdbcType=TIMESTAMP}, #{messageUpdateTime,jdbcType=TIMESTAMP}, 
      #{messageActivity,jdbcType=VARCHAR}, #{messageIsTop,jdbcType=INTEGER}, #{messageIsDel,jdbcType=INTEGER}, 
      #{messageIsInteraction,jdbcType=INTEGER}, #{messageIsRecommend,jdbcType=INTEGER}, 
      #{messageRecommendTime,jdbcType=TIMESTAMP}, #{sortTime,jdbcType=BIGINT}, #{messageImg,jdbcType=LONGVARCHAR}, 
      #{messageVideo,jdbcType=LONGVARCHAR}, #{messageVideoImg,jdbcType=LONGVARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.culturecloud.model.bean.live.CcpLiveMessage">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Feb 04 14:19:07 CST 2017.
    -->
    insert into ccp_live_message
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="messageId != null">
        message_id,
      </if>
      <if test="messageContent != null">
        message_content,
      </if>
      <if test="messageCreateUser != null">
        message_create_user,
      </if>
      <if test="messageCreateTime != null">
        message_create_time,
      </if>
      <if test="messageUpdateTime != null">
        message_update_time,
      </if>
      <if test="messageActivity != null">
        message_activity,
      </if>
      <if test="messageIsTop != null">
        message_is_top,
      </if>
      <if test="messageIsDel != null">
        message_is_del,
      </if>
      <if test="messageIsInteraction != null">
        message_is_interaction,
      </if>
      <if test="messageIsRecommend != null">
        message_is_recommend,
      </if>
      <if test="messageRecommendTime != null">
        message_recommend_time,
      </if>
      <if test="sortTime != null">
        sort_time,
      </if>
      <if test="messageImg != null">
        message_img,
      </if>
      <if test="messageVideo != null">
        message_video,
      </if>
      <if test="messageVideoImg != null">
        message_video_img,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="messageId != null">
        #{messageId,jdbcType=VARCHAR},
      </if>
      <if test="messageContent != null">
        #{messageContent,jdbcType=VARCHAR},
      </if>
      <if test="messageCreateUser != null">
        #{messageCreateUser,jdbcType=VARCHAR},
      </if>
      <if test="messageCreateTime != null">
        #{messageCreateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="messageUpdateTime != null">
        #{messageUpdateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="messageActivity != null">
        #{messageActivity,jdbcType=VARCHAR},
      </if>
      <if test="messageIsTop != null">
        #{messageIsTop,jdbcType=INTEGER},
      </if>
      <if test="messageIsDel != null">
        #{messageIsDel,jdbcType=INTEGER},
      </if>
      <if test="messageIsInteraction != null">
        #{messageIsInteraction,jdbcType=INTEGER},
      </if>
      <if test="messageIsRecommend != null">
        #{messageIsRecommend,jdbcType=INTEGER},
      </if>
      <if test="messageRecommendTime != null">
        #{messageRecommendTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sortTime != null">
        #{sortTime,jdbcType=BIGINT},
      </if>
      <if test="messageImg != null">
        #{messageImg,jdbcType=LONGVARCHAR},
      </if>
      <if test="messageVideo != null">
        #{messageVideo,jdbcType=LONGVARCHAR},
      </if>
      <if test="messageVideoImg != null">
        #{messageVideoImg,jdbcType=LONGVARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.culturecloud.model.bean.live.CcpLiveMessage">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Feb 04 14:19:07 CST 2017.
    -->
    update ccp_live_message
    <set>
      <if test="messageContent != null">
        message_content = #{messageContent,jdbcType=VARCHAR},
      </if>
      <if test="messageCreateUser != null">
        message_create_user = #{messageCreateUser,jdbcType=VARCHAR},
      </if>
      <if test="messageCreateTime != null">
        message_create_time = #{messageCreateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="messageUpdateTime != null">
        message_update_time = #{messageUpdateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="messageActivity != null">
        message_activity = #{messageActivity,jdbcType=VARCHAR},
      </if>
      <if test="messageIsTop != null">
        message_is_top = #{messageIsTop,jdbcType=INTEGER},
      </if>
      <if test="messageIsDel != null">
        message_is_del = #{messageIsDel,jdbcType=INTEGER},
      </if>
      <if test="messageIsInteraction != null">
        message_is_interaction = #{messageIsInteraction,jdbcType=INTEGER},
      </if>
      <if test="messageIsRecommend != null">
        message_is_recommend = #{messageIsRecommend,jdbcType=INTEGER},
      </if>
      <if test="messageRecommendTime != null">
        message_recommend_time = #{messageRecommendTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sortTime != null">
        sort_time = #{sortTime,jdbcType=BIGINT},
      </if>
      <if test="messageImg != null">
        message_img = #{messageImg,jdbcType=LONGVARCHAR},
      </if>
      <if test="messageVideo != null">
        message_video = #{messageVideo,jdbcType=LONGVARCHAR},
      </if>
      <if test="messageVideoImg != null">
        message_video_img = #{messageVideoImg,jdbcType=LONGVARCHAR},
      </if>
    </set>
    where message_id = #{messageId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.culturecloud.model.bean.live.CcpLiveMessage">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Feb 04 14:19:07 CST 2017.
    -->
    update ccp_live_message
    set message_content = #{messageContent,jdbcType=VARCHAR},
      message_create_user = #{messageCreateUser,jdbcType=VARCHAR},
      message_create_time = #{messageCreateTime,jdbcType=TIMESTAMP},
      message_update_time = #{messageUpdateTime,jdbcType=TIMESTAMP},
      message_activity = #{messageActivity,jdbcType=VARCHAR},
      message_is_top = #{messageIsTop,jdbcType=INTEGER},
      message_is_del = #{messageIsDel,jdbcType=INTEGER},
      message_is_interaction = #{messageIsInteraction,jdbcType=INTEGER},
      message_is_recommend = #{messageIsRecommend,jdbcType=INTEGER},
      message_recommend_time = #{messageRecommendTime,jdbcType=TIMESTAMP},
      sort_time = #{sortTime,jdbcType=BIGINT},
      message_img = #{messageImg,jdbcType=LONGVARCHAR},
      message_video = #{messageVideo,jdbcType=LONGVARCHAR},
      message_video_img = #{messageVideoImg,jdbcType=LONGVARCHAR}
    where message_id = #{messageId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.culturecloud.model.bean.live.CcpLiveMessage">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Feb 04 14:19:07 CST 2017.
    -->
    update ccp_live_message
    set message_content = #{messageContent,jdbcType=VARCHAR},
      message_create_user = #{messageCreateUser,jdbcType=VARCHAR},
      message_create_time = #{messageCreateTime,jdbcType=TIMESTAMP},
      message_update_time = #{messageUpdateTime,jdbcType=TIMESTAMP},
      message_activity = #{messageActivity,jdbcType=VARCHAR},
      message_is_top = #{messageIsTop,jdbcType=INTEGER},
      message_is_del = #{messageIsDel,jdbcType=INTEGER},
      message_is_interaction = #{messageIsInteraction,jdbcType=INTEGER},
      message_is_recommend = #{messageIsRecommend,jdbcType=INTEGER},
      message_recommend_time = #{messageRecommendTime,jdbcType=TIMESTAMP},
      sort_time = #{sortTime,jdbcType=BIGINT}
    where message_id = #{messageId,jdbcType=VARCHAR}
  </update>
  <resultMap extends="ResultMapWithBLOBs" id="BaseResultDtoMap" type="com.culturecloud.dao.dto.live.CcpLiveMessageDto">
  		<result column="date" javaType="java.sql.Timestamp" jdbcType="TIMESTAMP" property="date" />
  </resultMap>
   
  
  <select id="selectLiveMessageList" parameterType="com.culturecloud.model.request.live.CcpLiveMessagePageVO" resultMap="BaseResultDtoMap"> 
  
    select 
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />,
    IF(message_is_recommend=1,message_recommend_time,message_create_time) AS date,
  
  	IF(u.USER_NICK_NAME IS NOT NULL,u.USER_NICK_NAME,u.USER_NAME) AS userName,

	u.USER_HEAD_IMG_URL AS userHeadImgUrl
    
    from ccp_live_message m
    
	LEFT JOIN `cms_terminal_user` u ON u.user_id=m.message_create_user

    where 1=1
    
    <if test="messageIsTop != null">
       and message_is_top = #{messageIsTop,jdbcType=INTEGER}
      </if>
      <if test="messageActivity != null">
        and message_activity = #{messageActivity,jdbcType=VARCHAR}
      </if> 
      <choose>
      	<when test="messageIsInteraction == null and messageIsRecommend== null">
   	   AND (message_is_interaction = 0 OR message_is_recommend = 1 OR message_is_recommend IS NULL)
      	</when>
      	<otherwise>
      	<if test="messageIsInteraction != null">
		      	and message_is_interaction = #{messageIsInteraction,jdbcType=VARCHAR}
		      </if>
		      <if test="messageIsRecommend != null">
		      	and message_is_recommend= #{messageIsRecommend,jdbcType=VARCHAR}
		      </if>
      	</otherwise>
      </choose>
      <if test="messageCreateUser != null">
      	and message_create_user= #{messageCreateUser,jdbcType=VARCHAR}
      </if>
      
      <if test="resultStartTime != null">
      	and sort_time &lt;= #{resultStartTime}
      </if>
      <if test="resultEndTime != null">
      	and sort_time &gt; #{resultEndTime}
      </if>
      
      and message_is_del = 1
      
      <choose>
      	<!-- 已结束 -->
      	<when test="liveStatus == 2">
      		 order by message_is_top desc ,date asc,sort_time asc
      	</when>
      	<otherwise>
      		 order by message_is_top desc ,date desc,sort_time desc
      	</otherwise>
      </choose>
    
    <if test="resultFirst != null">
        limit ${resultFirst},${resultSize}
    </if>
  
  </select>
  
  <select id="getLiveHistoryVideoList" parameterType="java.lang.String" resultMap="BaseResultDtoMap">
  	select
  	
  	m.message_id,m.message_video,m.message_video_img
  	
  	from ccp_live_message m
  
  	 where 1=1
  	 
  	AND (message_is_interaction = 0 OR message_is_recommend = 1 OR message_is_recommend IS NULL)
  	
  	and message_video is not null and message_video != ''
  	
  	and message_activity = #{liveActivityId,jdbcType=VARCHAR}
  	
  	and message_is_del = 1
  	
  	order by sort_time desc
  	
  	limit 10
  
  </select>
  
  <select id="selectLiveMessageCount" parameterType="com.culturecloud.model.request.live.CcpLiveMessagePageVO" resultType="java.lang.Integer">
  	select count(*) 

 	from ccp_live_message
    
    where 1=1
    
    <if test="messageIsTop != null">
       and message_is_top = #{messageIsTop,jdbcType=INTEGER}
      </if>
      <if test="messageActivity != null">
        and message_activity = #{messageActivity,jdbcType=VARCHAR}
      </if> 
      <choose>
      	<when test="messageIsInteraction == null and messageIsRecommend== null">
      AND (message_is_interaction = 0 OR message_is_recommend = 1 OR message_is_recommend IS NULL)
      	</when>
      	<otherwise>
      	<if test="messageIsInteraction != null">
		      	and message_is_interaction = #{messageIsInteraction,jdbcType=VARCHAR}
		      </if>
		      <if test="messageIsRecommend != null">
		      	and message_is_recommend= #{messageIsRecommend,jdbcType=VARCHAR}
		      </if>
      	</otherwise>
      </choose>
      <if test="messageCreateUser != null">
      	and message_create_user= #{messageCreateUser,jdbcType=VARCHAR}
      </if>
      <if test="resultStartTime != null">
      	and sort_time &lt;= #{resultStartTime}
      </if>
      <if test="resultEndTime != null">
      	and sort_time &gt; #{resultEndTime}
      </if>
      
      and message_is_del = 1 
  </select>
 
</mapper>